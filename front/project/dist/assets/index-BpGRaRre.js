import{d as A,y as Y,q as f,m as w,x as L,E as u,H as I,o as g,c as b,a as s,t as m,F,k as T,b as l,w as n,e as V,h as j,g as z,i as J,p as G,I as K,r as c,_ as Q}from"./index-B7BW4uVQ.js";const W={class:"checkout-page"},X={key:0,class:"checkout-content"},Z={class:"order-summary"},ee={class:"restaurant-info"},re={class:"items-list"},ae={class:"quantity"},te={class:"name"},le={class:"price"},oe={class:"summary"},se={class:"summary-item"},ne={class:"summary-item"},de={class:"summary-item total"},ue={class:"delivery-form"},ie={class:"card-details"},me={class:"actions"},pe=A({__name:"index",setup(ce){const h=J(),O=Y(),N=f(),x=f(!1),v=f([]),p=f(null),a=f({name:"",phone:"",address:"",instructions:"",paymentMethod:"cash",cardNumber:"",cardExpiry:"",cardCvv:"",cardHolderName:""}),D=f({name:[{required:!0,message:"Please enter your name",trigger:"blur"},{min:2,message:"Name must be at least 2 characters",trigger:"blur"}],phone:[{required:!0,message:"Please enter your phone number",trigger:"blur"}],address:[{required:!0,message:"Please enter your address",trigger:"blur"},{min:5,message:"Address must be at least 5 characters",trigger:"blur"}],paymentMethod:[{required:!0,message:"Please select a payment method",trigger:"change"}],cardNumber:[{required:!0,message:"Please enter card number",trigger:"blur",validator:(t,e,r)=>{a.value.paymentMethod==="credit_card"?e?/^\d{16}$/.test(e.replace(/\s/g,""))?r():r(new Error("Please enter a valid 16-digit card number")):r(new Error("Please enter card number")):r()}}],cardExpiry:[{required:!0,message:"Please enter expiry date",trigger:"blur",validator:(t,e,r)=>{a.value.paymentMethod==="credit_card"?e?/^\d{2}\/\d{2}$/.test(e)?r():r(new Error("Please enter date in MM/YY format")):r(new Error("Please enter expiry date")):r()}}],cardCvv:[{required:!0,message:"Please enter CVV",trigger:"blur",validator:(t,e,r)=>{a.value.paymentMethod==="credit_card"?e?/^\d{3}$/.test(e)?r():r(new Error("Please enter a valid 3-digit CVV")):r(new Error("Please enter CVV")):r()}}],cardHolderName:[{required:!0,message:"Please enter card holder name",trigger:"blur",validator:(t,e,r)=>{a.value.paymentMethod==="credit_card"?e?e.length<2?r(new Error("Name must be at least 2 characters")):r():r(new Error("Please enter card holder name")):r()}}]}),E=w(()=>v.value.reduce((t,e)=>t+Number(e.price)*Number(e.quantity),0)),P=w(()=>{var t;return Number((t=p.value)==null?void 0:t.delivery_fee)||0}),C=w(()=>E.value+P.value),$=()=>{const t=localStorage.getItem("cart");if(console.log("Raw cart data from localStorage:",t),!t){u.warning("Your cart is empty"),h.push("/restaurants");return}try{const e=JSON.parse(t);if(console.log("Parsed cart data:",e),!e.restaurantId||!Array.isArray(e.items))throw new Error("Invalid cart data");e.restaurant?p.value={...e.restaurant,delivery_fee:Number(e.restaurant.delivery_fee)||0,minimum_order:Number(e.restaurant.minimum_order)||0}:p.value={id:e.restaurantId,delivery_fee:2,minimum_order:10},v.value=e.items.map(r=>({...r,price:Number(r.price),quantity:Number(r.quantity)})),console.log("Loaded cart data:",{restaurant:p.value,items:v.value})}catch(e){console.error("Failed to load cart:",e),u.error("Failed to load cart data"),h.push("/restaurants")}},S=async()=>{var t,e;if(N.value)try{if(await N.value.validate(),x.value=!0,!p.value)throw new Error("Restaurant not found");const r={restaurantId:p.value.id,items:v.value.map(i=>({menuItemId:i.id,quantity:Number(i.quantity)})),deliveryInfo:{address:a.value.address,phone:a.value.phone},paymentMethod:a.value.paymentMethod};if(a.value.paymentMethod==="credit_card"){const i=a.value.cardNumber.replace(/\s/g,"");r.paymentDetails={cardLastFour:i.slice(-4),cardHolderName:a.value.cardHolderName}}console.log("Sending order data:",r);const d=await G.post("/api/orders",r);if(console.log("Order response:",d),d.message==="Order created successfully")localStorage.removeItem("cart"),await K.alert(`Order created successfully!

Order Number: ${d.orderNumber}
Order ID: ${d.orderId}`,"Order Confirmed",{confirmButtonText:"View Orders",type:"success"}),h.push("/orders");else throw new Error("Failed to create order")}catch(r){if(console.error("Failed to create order:",r),(e=(t=r.response)==null?void 0:t.data)!=null&&e.error)switch(r.response.data.error){case"Minimum order amount is 20.00":u.error("Order amount too low. Minimum order amount is $20.00");break;case"Some menu items are not available":u.error("Some items in your cart are no longer available");break;case"Restaurant not found or not active":u.error("Restaurant is currently not available");break;case"Payment details are required for credit card payment":u.error("Please provide valid payment details");break;case"Delivery information is required":u.error("Please provide delivery information");break;case"Invalid payment method":u.error("Please select a valid payment method");break;default:u.error(r.response.data.error)}else r.message?u.error(r.message):u.error("Failed to create order. Please try again.")}finally{x.value=!1}};L(()=>{if(!O.isAuthenticated){u.warning("Please login to continue"),h.push({path:"/auth/login",query:{redirect:h.currentRoute.value.fullPath}});return}$()});const k=t=>{const r=t.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),d=r&&r[0]||"",i=[];for(let y=0,_=d.length;y<_;y+=4)i.push(d.substring(y,y+4));return i.length?i.join(" "):t};I(()=>a.value.cardNumber,t=>{t&&(a.value.cardNumber=k(t))});const H=t=>{const e=t.replace(/\s+/g,"").replace(/[^0-9]/gi,"");return e.length>=2?e.slice(0,2)+"/"+e.slice(2,4):e};return I(()=>a.value.cardExpiry,t=>{t&&(a.value.cardExpiry=H(t))}),(t,e)=>{var M,q;const r=c("el-input"),d=c("el-form-item"),i=c("el-radio"),y=c("el-radio-group"),_=c("el-button"),R=c("el-form"),U=c("router-link"),B=c("el-empty");return g(),b("div",W,[e[19]||(e[19]=s("h1",null,"Checkout",-1)),v.value.length?(g(),b("div",X,[s("div",Z,[e[13]||(e[13]=s("h2",null,"Order Summary",-1)),s("div",ee,[s("h3",null,m((M=p.value)==null?void 0:M.name),1),s("p",null,m((q=p.value)==null?void 0:q.address),1)]),s("div",re,[(g(!0),b(F,null,T(v.value,o=>(g(),b("div",{key:o.id,class:"item"},[s("span",ae,m(o.quantity)+"x",1),s("span",te,m(o.name),1),s("span",le,"$"+m((o.price*o.quantity).toFixed(2)),1)]))),128))]),s("div",oe,[s("div",se,[e[10]||(e[10]=s("span",null,"Subtotal:",-1)),s("span",null,"$"+m(E.value.toFixed(2)),1)]),s("div",ne,[e[11]||(e[11]=s("span",null,"Delivery Fee:",-1)),s("span",null,"$"+m(P.value.toFixed(2)),1)]),s("div",de,[e[12]||(e[12]=s("span",null,"Total:",-1)),s("span",null,"$"+m(C.value.toFixed(2)),1)])])]),s("div",ue,[e[17]||(e[17]=s("h2",null,"Delivery Information",-1)),l(R,{ref_key:"formRef",ref:N,model:a.value,rules:D.value,"label-position":"top",size:"large"},{default:n(()=>[l(d,{label:"Full Name",prop:"name"},{default:n(()=>[l(r,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.name=o),placeholder:"Enter your full name"},null,8,["modelValue"])]),_:1}),l(d,{label:"Phone Number",prop:"phone"},{default:n(()=>[l(r,{modelValue:a.value.phone,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.phone=o),placeholder:"Enter your phone number"},null,8,["modelValue"])]),_:1}),l(d,{label:"Delivery Address",prop:"address"},{default:n(()=>[l(r,{modelValue:a.value.address,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.address=o),type:"textarea",rows:2,placeholder:"Enter your delivery address"},null,8,["modelValue"])]),_:1}),l(d,{label:"Delivery Instructions (Optional)"},{default:n(()=>[l(r,{modelValue:a.value.instructions,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.instructions=o),type:"textarea",rows:2,placeholder:"Any special instructions for delivery? (Optional)"},null,8,["modelValue"])]),_:1}),l(d,{label:"Payment Method",prop:"paymentMethod"},{default:n(()=>[l(y,{modelValue:a.value.paymentMethod,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.paymentMethod=o)},{default:n(()=>[l(i,{label:"cash"},{default:n(()=>e[14]||(e[14]=[V("Cash on Delivery")])),_:1}),l(i,{label:"credit_card"},{default:n(()=>e[15]||(e[15]=[V("Online Payment")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a.value.paymentMethod==="credit_card"?(g(),b(F,{key:0},[l(d,{label:"Card Number",prop:"cardNumber"},{default:n(()=>[l(r,{modelValue:a.value.cardNumber,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.cardNumber=o),placeholder:"Enter your card number",maxlength:"16"},null,8,["modelValue"])]),_:1}),s("div",ie,[l(d,{label:"Expiry Date",prop:"cardExpiry"},{default:n(()=>[l(r,{modelValue:a.value.cardExpiry,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.cardExpiry=o),placeholder:"MM/YY",maxlength:"5"},null,8,["modelValue"])]),_:1}),l(d,{label:"CVV",prop:"cardCvv"},{default:n(()=>[l(r,{modelValue:a.value.cardCvv,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.cardCvv=o),placeholder:"CVV",maxlength:"3","show-password":""},null,8,["modelValue"])]),_:1})]),l(d,{label:"Card Holder Name",prop:"cardHolderName"},{default:n(()=>[l(r,{modelValue:a.value.cardHolderName,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.cardHolderName=o),placeholder:"Name on card"},null,8,["modelValue"])]),_:1})],64)):j("",!0),s("div",me,[l(_,{onClick:e[9]||(e[9]=o=>t.$router.push("/cart"))},{default:n(()=>e[16]||(e[16]=[V("Back to Cart")])),_:1}),l(_,{type:"primary",loading:x.value,onClick:S,disabled:!v.value.length},{default:n(()=>[V(" Place Order ($"+m(C.value.toFixed(2))+") ",1)]),_:1},8,["loading","disabled"])])]),_:1},8,["model","rules"])])])):(g(),z(B,{key:1,description:"Your cart is empty"},{extra:n(()=>[l(U,{to:"/restaurants"},{default:n(()=>[l(_,{type:"primary"},{default:n(()=>e[18]||(e[18]=[V("Browse Restaurants")])),_:1})]),_:1})]),_:1}))])}}}),ye=Q(pe,[["__scopeId","data-v-3191565a"]]);export{ye as default};
